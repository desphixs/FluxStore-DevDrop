
{% extends "base/base.html" %}
{% load static %}

{% block content %}
<main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10 lg:mt-52 mt-14">
  <!-- Header -->
  <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">All Vendors</h1>
      <p class="text-sm text-gray-600">Browse verified stores, compare ratings, and dive into their catalogs.</p>
    </div>

    <form method="get" class="w-full sm:w-80">
      <div class="relative">
        <input
          type="text"
          name="q"
          value="{{ q }}"
          placeholder="Search vendors..."
          class="w-full rounded-lg border px-3 py-2 pr-9 focus:outline-none focus:ring-2 focus:ring-[#991b1b]"
        />
        <button type="submit" class="absolute right-2 top-2 text-gray-400">
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none">
            <path d="M21 21l-4.3-4.3M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </form>
  </div>

  {% if page_obj.object_list %}
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
    {% for v in page_obj.object_list %}
    <article class="group relative overflow-hidden rounded-2xl border bg-white shadow-sm transition hover:-translate-y-0.5 hover:shadow-lg">
      <!-- Banner / Logo -->
      <div class="relative h-36 bg-gray-50">
        {% if v.banner %}
          <img src="{{ v.banner.url }}" alt="{{ v.business_name }} banner" class="h-full w-full object-cover"/>
        {% endif %}
        <div class="absolute -bottom-6 left-4 h-16 w-16 overflow-hidden rounded-xl border bg-white shadow">
          {% if v.logo %}
            <img src="{{ v.logo.url }}" alt="{{ v.business_name }} logo" class="h-full w-full object-contain"/>
          {% else %}
            <div class="flex h-full w-full items-center justify-center text-sm text-gray-400">No logo</div>
          {% endif %}
        </div>
      </div>

      <div class="px-4 pb-4 pt-8">
        <div class="mb-1 flex items-center gap-2">
          <h2 class="truncate text-base font-semibold text-gray-900">
            <a href="{% url 'vendor:vendor_detail' v.slug %}" class="hover:text-[#991b1b]">{{ v.business_name }}</a>
          </h2>
          {% if v.is_verified %}
            <span class="inline-flex items-center rounded-md bg-emerald-50 px-1.5 py-0.5 text-[10px] font-semibold text-emerald-700 ring-1 ring-inset ring-emerald-600/20">Verified</span>
          {% endif %}
        </div>

        <p class="line-clamp-2 text-xs text-gray-600">
          {{ v.business_description|default:"" }}
        </p>

        <!-- Stats -->
        <div class="mt-4 grid grid-cols-2 gap-2 text-xs">
          <div class="rounded-lg border p-2">
            <p class="text-gray-500">Products</p>
            <p class="font-semibold text-gray-900">{{ v.total_products|default:0 }}</p>
          </div>
          <div class="rounded-lg border p-2">
            <p class="text-gray-500">Rating</p>
            <p class="font-semibold text-gray-900">
              {{ v.avg_rating|floatformat:1 }} <span class="text-[11px] text-gray-500">({{ v.reviews_count|default:0 }} reviews)</span>
            </p>
          </div>
          <div class="rounded-lg border p-2">
            <p class="text-gray-500">In-stock SKUs</p>
            <p class="font-semibold text-gray-900">{{ v.in_stock_skus|default:0 }}</p>
          </div>
          <div class="rounded-lg border p-2">
            <p class="text-gray-500">Active deals</p>
            <p class="font-semibold text-gray-900">{{ v.active_deals|default:0 }}</p>
          </div>
        </div>

        <!-- Price range & meta -->
        <div class="mt-3 flex items-center justify-between text-xs text-gray-600">
          <span>Price: 
            {% if v.min_price and v.max_price %}
              {{site_config.currency_abbr}}{{ v.min_price }} – {{site_config.currency_abbr}}{{ v.max_price }}
            {% else %}
              —
            {% endif %}
          </span>
          <span class="truncate">{{ v.country|default:"" }}</span>
        </div>

        <!-- CTA -->
        <div class="mt-4">
          <a href="{% url 'vendor:vendor_detail' v.slug %}" class="inline-flex w-full items-center justify-center rounded-lg bg-[#991b1b] px-3 py-2 text-sm font-semibold text-white hover:opacity-90">
            Visit Store
          </a>
        </div>
      </div>
    </article>
    {% endfor %}
  </div>

  <!-- Pagination -->
  <div class="mt-8 flex items-center justify-center gap-2">
    {% if page_obj.has_previous %}
      <a href="?{% if q %}q={{ q }}&{% endif %}page={{ page_obj.previous_page_number }}" class="rounded-lg border px-3 py-2 text-sm">Prev</a>
    {% else %}
      <button class="rounded-lg border px-3 py-2 text-sm opacity-40" disabled>Prev</button>
    {% endif %}
    <span class="text-sm text-gray-700">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?{% if q %}q={{ q }}&{% endif %}page={{ page_obj.next_page_number }}" class="rounded-lg border px-3 py-2 text-sm">Next</a>
    {% else %}
      <button class="rounded-lg border px-3 py-2 text-sm opacity-40" disabled>Next</button>
    {% endif %}
  </div>

  {% else %}
    <div class="rounded-2xl border p-10 text-center text-gray-600">
      No vendors found. Try a different search.
    </div>
  {% endif %}
</main>
{% endblock %}
